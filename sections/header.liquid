<header id="js-header" class="fixed bg-primary w-full z-50 h-16 font-sans">
  <div class="wrapper h-full grid grid-cols-3 gap-4">
    <nav class="hidden lg:block h-full">
      <ul class="flex gap-6 h-full items-center">
        {%- for link in linklists.revamped-menu.links -%}
          <li class=""
            x-data="{ megaMenuOpen: false }"
            @mouseenter="megaMenuOpen = true"
            @mouseleave="megaMenuOpen = false"
          >
            <a href="{{ link.url }}" class="link">
              {{ link.title }}
            </a>
            
            {% if link.links.size > 0 %}
              <div x-cloak
                x-show="megaMenuOpen"
                class="absolute left-0 right-0 top-16 bg-primary drop-shadow-lg"
                x-transition:enter="transition ease-out duration-200"
                x-transition:enter-start="opacity-0 translate-y-1"
                x-transition:enter-end="opacity-100 translate-y-0"
                x-transition:leave="transition ease-in duration-150"
                x-transition:leave-start="opacity-100 translate-y-0"
                x-transition:leave-end="opacity-0 translate-y-1"
              >
                <div class="wrapper py-8">
                  <div class="grid grid-cols-12 gap-4">
                    {% for childlink in link.links %}
                      <div class="col-start-2 col-span-4 grid grid-cols-2 gap-4">
                        <h3 class="mb-4">{{ childlink.title }}</h3>
                        {% if childlink.links.size > 0 %}
                          <ul class="space-y-2 [&:has(a:hover)_a:not(:hover)]:opacity-50 transition-opacity duration-300">
                            {% for grandchildlink in childlink.links %}
                              <li>
                                <a href="{{ grandchildlink.url }}" class="link transition-opacity duration-200">
                                  {{ grandchildlink.title }}
                                </a>
                              </li>
                            {% endfor %}
                          </ul>
                        {% endif %}
                      </div>
                    {% endfor %}
                  </div>
                </div>
              </div>
            {% endif %}
          </li>
        {%- endfor -%}
      </ul>
    </nav>
    <button x-data @click="$dispatch('toggle-menu-drawer')" class="lg:hidden">
      <span class="sr-only">Menu</span>
      <span class="hamburger">
        <span class="line"></span>
        <span class="line"></span>
        <span class="line"></span>
      </span>
    </button>
    <div class="flex justify-center items-center">
      <a href="{{ routes.root_url }}" class="{% if template == 'index' %}home-page-logo{% endif %}">
        {% render 'header-logo' %}
      </a>
    </div>
    <div class="h-full flex items-center justify-end">
      <button 
        x-data
        @click="$dispatch('toggle-cart-drawer')"
        class="link"
        type="button"
      >
        cart
      </button>
    </div>
  </div>

  <div class="" x-data="{ menuOpen: false }" @toggle-menu-drawer.window="menuOpen = !menuOpen">
    <div x-cloak x-show="menuOpen" class="drawer-backdrop" @click="menuOpen = false"></div>

    <div
      x-cloak
      x-show="menuOpen"
      x-transition:enter="transform transition ease-in-out duration-500"
      x-transition:enter-start="-translate-x-full"
      x-transition:enter-end="translate-x-0"
      x-transition:leave="transform transition ease-in-out duration-500"
      x-transition:leave-start="translate-x-0"
      x-transition:leave-end="-translate-x-full"
      class="fixed left-0 top-0 h-full w-full max-w-[446px] bg-primary text-contrast shadow-lg"
      role="dialog"
      aria-modal="true"
    >
      <div class="p-4 h-full">
        <div class="flex justify-between items-center">
          <h2 class="link">Menu</h2>
          <button @click="menuOpen = false" class="">&times;</button>
        </div>
        <div class="mt-24 h-full flex flex-col justify-between w-full">
          {% render 'mobile-menu' %}
        </div>
      </div>
    </div>
  </div>

  <!-- Add the cart drawer markup -->
  <div
    x-data="{ open: false }"
    @toggle-cart-drawer.window="open = !open"
    @keydown.escape.window="open = false"
  >
    <!-- Backdrop -->
    <div 
      x-show="open"
      class="drawer-backdrop"
      @click="open = false"
      x-cloak
    ></div>

    <!-- Drawer -->
    <div
      x-show="open"
      x-cloak
      x-transition:enter="transform transition ease-in-out duration-500"
      x-transition:enter-start="translate-x-full"
      x-transition:enter-end="translate-x-0"
      x-transition:leave="transform transition ease-in-out duration-500"
      x-transition:leave-start="translate-x-0"
      x-transition:leave-end="translate-x-full"
      class="fixed right-0 top-0 h-full max-w-[446px] w-full bg-primary text-contrast shadow-lg"
      role="dialog"
      aria-modal="true"
    >
      <div class="p-4 h-full flex flex-col">
        <div class="flex justify-between items-center">
          <h2 class="link">Cart</h2>
          <button @click="open = false" class="">&times;</button>
        </div>
        <div class="mt-24 flex flex-col justify-between w-full flex-grow">
          {% render 'cart-drawer' %}
        </div>
      </div>
    </div>
  </div>
</header>

{% schema %}
{
  "name": "t:sections.header.name",
  "class": "section-header",
  "blocks": [
    {
			"type": "mega_menu",
			"name": "t:sections.header.blocks.mega_menu.name",
			"settings": [
				{
					"type": "text",
					"id": "mega_menu_trigger",
					"label": "t:sections.header.blocks.mega_menu.settings.mega_menu_trigger.label",
					"info": "t:sections.header.blocks.mega_menu.settings.mega_menu_trigger.info"
				},
				{
					"type": "text",
					"id": "mega_menu_header",
					"default": "Shop All",
					"label": "t:sections.header.blocks.mega_menu.settings.mega_menu_header.label"
				},
				{
					"type": "header",
					"content": "Card"
				},
				{
					"type": "text",
					"id": "title",
					"label": "Title"
				},
				{
					"type": "url",
					"id": "link",
					"label": "Link"
				},
				{
					"type": "image_picker",
					"id": "image",
					"label": "Image"
				}
			]
		}
	]
}
{% endschema %}
